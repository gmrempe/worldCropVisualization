<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />

    <script src="https://d3js.org/d3.v5.min.js"></script>

</head>

<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <script>
        const year = '2017';
        const treeData = d3.csv("/FAOSTAT_data_7-9-2019.csv").then(function (data) {

        // select one year of data
        let filteredData = data.filter(function(d) {
            if(year === d.Year) {
                return d
            }
        })
            
        // setup node structure with year as root
        let dataMap = filteredData.reduce(function(map, node) {
            map[node.Year] = { 'year': node.Year, 'parent': null };
            map[node.Item] = { 'item': node.Item, 'parent': node.Year };
            map[node.Area + node.Item] = { 'area': node.Area, 'value': node.Value, 'parent': node.Item };
            return map;
        }, {});
                
        // put nodes into tree
        const treeData = [];
        Object.values(dataMap).forEach(function (node) {
            let parent = dataMap[node.parent];
            if (parent) {
                (parent.children || (parent.children = []))
                .push(node);
            } else {
                treeData.push(node);
                }
            });
                    
            return treeData;
        });
        </script>        
    </body>
</html>