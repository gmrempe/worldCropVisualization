<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />

    <title>World Crop Production Visualization</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>


    <!-- <script src="./visual.js"></script> -->

</head>

<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div className="App">
        <header className="App-header">
            World Crop Production
        </header>

        <label for='year'>Select a Year</label>
    
        <select className="year" id='year'>
            <option value="2017" selected></option>
            <option value="2010"></option>
            <option value="2000"></option>
            <option value="1990"></option>
            <option value="1980"></option>
            <option value="1970"></option>
            <option value="1961"></option>
        </select>
    
        <div id="chart"></div> 
   
        <script>
            const year = document.getElementById('year').selectedOptions[0].value;
;
d3.csv("/FAOSTAT_data_7-9-2019.csv").then(function (data) {
                let filteredData = data.filter(function(d) {
                    if((year === d.Year) && (d.Value > 0)) {
                        return d
                    }
                })
                
                let dataMap = filteredData.reduce(function(map, node) {
                    map[node.Year] = { 'year': node.Year, 'parent': null };
                    map[node.Item] = { 'item': node.Item, 'parent': node.Year };
                    map[node.Area + node.Item] = { 'area': node.Area, 'parent': node.Item };
                    map[node.Value + node.Item] = { 'value': node.Value, 'parent': node.Item };
                    return map;
                }, {});
                    debugger
                let treeData = [];
                filteredData.forEach(function (node) {
                    // add to parent
                    let parent = dataMap[node.parent];
                    if (parent) {
                        // create child array if it doesn't exist
                        (node.parent || (node.parent = []))
                            // add node to child array
                            .push(node);
                    } else {
                        // parent is null or missing
                        treeData.push(node);
                    }
                });

                let root = treeData[0];
                update(root);
            });

            // let csvjson = require('csvjson');
            // let fs = require('fs');
            // let data = fs.readFileSync(path.join(__dirname, '/FAOSTAT_data_7-9-2019.csv'), { encoding: 'utf8' });
            
            // let options = {
            //     delimiter: ',' // optional
            // };

            // csvjson.toSchemaObject(data, options)


            // let records = '/FAOSTAT_data_7-9-2019.csv';

            // debugger
            //     let output = records.map(record => {

            //         let arr = record.split(',')
            //         return {
            //             "year": arr[0],
            //             "children": [{
            //                 "crops": arr[1],
            //                 "children": [{
            //                     "country": arr[2],
            //                     "value": parseInt(arr[3])
            //                 }]
            //             }]
            //         }
            //     })

            //     console.log(output)
            // console.log(d3.csv("/FAOSTAT_data_7-9-2019.csv").then(function (stringData) {
                // const obj = {"year": null, "children": [{
                //     "crop": null, "children": [{
                //         "country": null,
                //         "value": null
                //     }]
                // }]}
                // debugger
                // let obj = {'children': [{'children': []}]};
                // for(let i = 0; i < stringData.length - 1; i++) {
                // debugger 
                //     obj[stringData[i].Year] = 'year',
                //     obj['children'][0][stringData[i].Item] = 'crop',
                //     obj['children'][0]['children'][stringData[i].Area] = 'country',
                //     obj['children'][0]['children'][parseInt(stringData[i].Value)] = 'value'
                    
                // } 
                // debugger
                // let output = stringData.map(record => {
                    // return {
                    //     'year': record.Year, "children": [{
                    //         'crop': record.Item, "children": [{
                    //             "country": (record.Area),
                    //             "value": parseInt(record.Value)
                    //         }]
                    //     }]
                    // }
                    // console.log(record);
                // });
                //     debugger
                // return output;
                // console.log(stringData);
                // console.log(obj)
            // }));
            // const data = d3.csv("/FAOSTAT_data_7-9-2019.csv")
            // debugger
        </script>

    </div>
 

</body>

</html>