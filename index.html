<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#000000" />

        <!-- <link rel="stylesheet" type="text/css" href="app.css" /> -->

        <title>World Crop Production Visualization</title>
        <script src="https://d3js.org/d3.v5.min.js"></script>

    </head>
    <style>
        @import url("https://fonts.googleapis.com/css?family=Montserrat");

        body {
            font-family: "Montserrat", "Helvetica Neue", Helvetica, Arial, sans-serif;
        }
    </style>
    <body>
        <noscript>You need to enable JavaScript to run this app.</noscript>
        <div className="App">
            <header className="App-header" style="font-size: 35px; margin-left: 3%; margin-bottom: 25px;">
                World Crop Production in Tonnes
            </header>

            <h1 style="font-size: 20px; margin-left: 3%;">Click on section to zoom in, Center to zoom out</h1>
            <a style="font-size: 15px; margin-left: 3%;" href="http://www.fao.org/faostat/en/#data/QC">Data from FAOSTAT</a>

            <label for='year' style="position: absolute; left: 33%; top: 560px;">Select Year </label>
            
            <select className="year" id='year' style="position: absolute; left: 34%; top: 580px;">
                    <option value="2017" selected>2017</option>
                    <option value="2010">2010</option>
                    <option value="2000">2000</option>
                    <option value="1990">1990</option>
                    <option value="1980">1980</option>
                    <option value="1970">1970</option>
                    <option value="1961">1961</option>
            </select>
        </div>        
        <svg style="margin-left: 3%;"></svg>

    </body>

    <script>
        const year = document.getElementById('year').selectedOptions[0].value;

        //grab data
        d3.json("/FAOSTATData.json").then(function (data) {
            
            let treeData = {};
            
            for(let i = 0; i < data.length; i++) {
                if(data[i].year === year) {
                    treeData = data[i];
                }
            }
            
            const width = 932;
            const height = 932;
            const radius = width / 2;
            const color = d3.scaleOrdinal(d3.quantize(d3.interpolateRainbow, treeData.children.length + 1));

            //place chart in center of svg element
            let g = d3.select('svg')
                .attr('width', width)
                .attr('height', height)
                .append('g')
                .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');
             
            //give every node a value and sort
            const root = d3.hierarchy(treeData)
                .sum(function(d) { return d.value})
                .sort((a, b) => b.value - a.value)
                
            //calculate radians then add x0, y0, x1, y1 onto each node
            const partitionLayout = d3.partition()
                .size([2 * Math.PI, radius]);
            
            partitionLayout(root);
            
            const arc = d3.arc()
                .startAngle(d => d.x0)
                .endAngle(d => d.x1)
                .innerRadius(d => d.y0)
                .outerRadius(d => d.y1);

            //make every node a g element
            g.selectAll('g')
                .data(root.descendants())
                .enter().append('g').attr("class", "node").append('path')
                .attr("display", function (d) { return d.depth ? null : "none"; })
                .attr("d", arc)
                .style('stroke', '#fff')
                .style("fill", function (d) { return color((d.children ? d : d.parent).data[Object.keys(d.data)[0]]); });

        });

    </script>
                                 
</html>