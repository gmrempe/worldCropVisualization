<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />

    <title>World Crop Production Visualization</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <!-- <script src="./visual.js"></script> -->
</head>

<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div className="App">
        <header className="App-header">
            World Crop Production
        </header>

        <label for='year'>Select Year</label>
    
        <select className="year" id='year'>
            <option value="2017" selected></option>
            <option value="2010"></option>
            <option value="2000"></option>
            <option value="1990"></option>
            <option value="1980"></option>
            <option value="1970"></option>
            <option value="1961"></option>
        </select>
    
        <!-- <div id="chart"></div>  -->
   
        <svg></svg>

        <script>
            const year = document.getElementById('year').selectedOptions[0].value;
            //grab data
            d3.csv("/FAOSTAT_data_7-9-2019.csv").then(function (data) {
                // select one year of data
                let filteredData = data.filter(function(d) {
                    if((year === d.Year) && (d.Value > 0)) {
                        return d
                    }
                })

                // setup node structure with year as root
                let dataMap = filteredData.reduce(function(map, node) {
                    map[node.Year] = { 'year': node.Year, 'parent': null };
                    map[node.Item] = { 'item': node.Item, 'parent': node.Year };
                    map[node.Area + node.Item] = { 'area': node.Area, 'value': node.Value, 'parent': node.Item };
                    return map;
                }, {});
                    
                // put nodes into tree
                let treeData = [];
                Object.values(dataMap).forEach(function (node) {
                    let parent = dataMap[node.parent];
                    if (parent) {
                        (parent.children || (parent.children = []))
                            .push(node);
                    } else {
                        treeData.push(node);
                    }
                });

                let root = treeData[0];
                // debugger
                //re-render
                // update(root);
            });

            // function update(root) {

            // }

            //setup chart
            let width = '100%';
            let height = auto;
            let radius = Math.min(width, height) / 2;
            let color = d3.scaleOrdinal(d3.quantize(d3.interpolateRainbow, data.children.length + 1));

            let g = d3.select('svg')
                  .attr('width', width)
                  .attr('height', height)
                .append('g')
                  .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');

            let partition = d3.partition()
                  .size([2 * Math.pi / radius])

        </script>

    </div>
 

</body>

</html>